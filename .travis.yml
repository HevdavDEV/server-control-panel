#
# .travis.yml - configuration file for the travis continuous integration service
#
# see http://about.travis-ci.org/docs/user/languages/cpp for more hints
#
language: cpp

cache:
  apt: true

matrix:
  fast_finish: true
  include:
    - compiler: ": Win64"
      env: HOST=x86_64-w64-mingw32 PACKAGES="gcc-mingw-w64-x86-64 g++-mingw-w64-x86-64 binutils-mingw-w64-x86-64 mingw-w64-dev wine wine-dev bc gcc-multilib g++-multilib"
    - compiler: ": Win32"
      env: HOST=i686-w64-mingw32 PACKAGES="gcc-mingw-w64-i686 g++-mingw-w64-i686 binutils-mingw-w64-i686 mingw-w64-dev wine wine-dev bc gcc-multilib g++-multilib"

before_install:
  - sudo add-apt-repository --yes ppa:beineri/opt-qt54
#  - sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
  - sudo add-apt-repository --yes ppa:tobydox/mingw-x-precise
  - sudo apt-get update -qq
  - sudo apt-get install qt54base qt54imageformats qt54tools qt54xmlpatterns -y -qq
  - uname -m
  - export QTDIR=/opt/qt54
  - export PATH=$QTDIR/bin:$PATH
  - export LD_LIBRARY_PATH=$QTDIR/lib/:$QTDIR/lib/`uname -m`-linux-gnu:$LD_LIBRARY_PATH
  #- sudo apt-get install libssl1.0.0 libssh2-1-dev -y -qq
#  - sudo apt-get install gcc-4.8 g++-4.8 gdb -y -qq
#  - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 20
#  - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 20
#  - sudo update-alternatives --config gcc
#  - sudo update-alternatives --config g++
#  - if [ "$BUILDMODE" = "cmake-mingw32" ]; then sudo apt-get install cmake make tofrodos mingw32-x-gcc mingw32-x-qt -y -qq; fi
#  - if [ "$BUILDMODE" = "cmake-mingw64" ]; then sudo apt-get install cmake make tofrodos mingw64-x-gcc mingw64-x-qt -y -qq; fi

install:
    - if [ -n "$PACKAGES" ]; then travis_retry sudo apt-get update; fi
    - if [ -n "$PACKAGES" ]; then travis_retry sudo apt-get install --no-install-recommends --no-upgrade -qq $PACKAGES; fi

before_script:
  - unset CC; unset CXX
  - make -j2 -C depends HOST=$HOST

script:
  - qmake -v
  - qmake -spec win32-x-g++ wpnxm-servercontrolpanel.pro
  - make -s -j 2

notifications:
  email: false
  irc:
    channels:
      - "irc.freenode.org#koch"
    use_notice: true